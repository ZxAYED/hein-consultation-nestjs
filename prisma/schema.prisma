generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                        String    @id @default(uuid())
  firstName                 String
  lastName                  String
  email                     String    @unique
  role                      UserRole  @default(CUSTOMER)
  companyName               String
  image                     String?
  street                    String?
  city                      String?
  zip                       String?
  country                   String?
  phoneNumber               String
  vatUid                    String?
  companyRegistrationNumber String?
  password                  String
  subject                   String?
  registrationOtp           String?
  registrationOtpExpireIn   DateTime?
  loginOtp                  String?
  loginOtpExpireIn          DateTime?
  resetPasswordOtp          String?
  resetPasswordOtpExpireIn  DateTime?
  lastPasswordChangeTime    DateTime?
  loginTime                 DateTime?
  registrationTime          DateTime?
  isVerified                Boolean   @default(false)
  isBlocked                 Boolean   @default(false)
  isDeleted                 Boolean   @default(false)
  createdAt                 DateTime  @default(now())
  updatedAt                 DateTime  @updatedAt

  documents     Document[]
  invoices      Invoice[]
  appointments  Appointment[]
  blogs         Blog[]
  notifications Notification[]
  services      Service[]
  comments      Comment[]
}

model ScheduleSlot {
  id String @id @default(uuid())

  serviceName String

  date      DateTime // normalized day (e.g. 2025-12-19T00:00:00)
  startTime DateTime
  endTime   DateTime

  durationMin Int

  status SlotStatus // Available | Booked | Disabled

  appointmentId String?      @unique
  appointment   Appointment?

  createdById String? // admin id or null (system)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([serviceName, date])
  @@index([date, startTime])
}

model Appointment {
  id            String @id @default(uuid())
  appointmentNo String @unique
  userId        String
  serviceName   String

  slotId      String            @unique
  scheduledAt DateTime
  meetingType MeetingType
  status      AppointmentStatus
  note        String?
  attachments Json?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user      User         @relation(fields: [userId], references: [id])
  slot      ScheduleSlot @relation(fields: [slotId], references: [id])
  documents Document[]
  invoice   Invoice?

  @@index([appointmentNo])
}

model Document {
  id            String  @id @default(uuid())
  userId        String
  appointmentId String?
  invoiceId     String?

  name        String
  type        DocumentType
  status      DocumentStatus
  format      String?
  size        Int?
  fileUrls    String[]
  tags        String[]
  description String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user        User         @relation(fields: [userId], references: [id])
  appointment Appointment? @relation(fields: [appointmentId], references: [id])
  invoice     Invoice?     @relation(fields: [invoiceId], references: [id])
  // audits      DocumentAudit[]
}

model Invoice {
  id            String  @id @default(uuid())
  invoiceNo     String  @unique
  userId        String
  appointmentId String?

  amount      Float
  status      InvoiceStatus
  paymentType InvoicePaymentType
  issuedBy    String
  issuedAt    DateTime
  dueDate     DateTime

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  user        User         @relation(fields: [userId], references: [id])
  appointment Appointment? @relation(fields: [appointmentId], references: [id])
  documents   Document[]

  @@unique([appointmentId])
  @@index([appointmentId])
  @@index([invoiceNo])
}

model Blog {
  id          String         @id @default(uuid())
  title       String
  adminId     String
  slug        String         @unique
  excerpt     String
  image       String
  content     String
  status      BlogStatus
  publishDate DateTime
  categories  BlogCategory[]
  tags        BlogTags[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt

  admin    User      @relation(fields: [adminId], references: [id])
  comments Comment[]
}

model Comment {
  id        String   @id @default(uuid())
  userId    String
  blogId    String
  content   String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User     @relation(fields: [userId], references: [id])
  blog      Blog     @relation(fields: [blogId], references: [id])
}

model Activity {
  id        String            @id @default(uuid())
  event     NotificationEvent
  entityId  String
  actorId   String
  userId    String?
  metadata  Json?
  createdAt DateTime          @default(now())
}

model Notification {
  id        String            @id @default(uuid())
  userId    String
  event     NotificationEvent
  title     String
  message   String
  isAdminRead    Boolean           @default(false)
  isCustomerRead Boolean           @default(false)
  metadata  Json?
  createdAt DateTime          @default(now())

  user User @relation(fields: [userId], references: [id])
}

enum NotificationEvent {
  DOCUMENT_UPLOADED
  DOCUMENT_APPROVED
  APPOINTMENT_CREATED
  APPOINTMENT_STATUS_CHANGED
  INVOICE_CREATED
  INVOICE_PAID
  BLOG_CREATED
  ADMIN_MANUAL
}

model Service {
  id          String          @id @default(uuid())
  name        String
  category    ServiceCategory
  adminId     String
  slug        String          @unique
  description String
  status      ServiceStatus
  image       String
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  admin       User            @relation(fields: [adminId], references: [id])
}

model AdminGeneralSetting {
  id                     String  @id @default("AdminGeneralSettingSingletonId")
  platformName           String
  slogan                 String
  language               String
  timezone               String
  currency               String
  logo                   String
  isBlogModuleEnabled    Boolean @default(true)
  isServiceModuleEnabled Boolean @default(true)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum ServiceCategory {
  Consulting
  Training
}

enum ServiceStatus {
  Active
  Inactive
}

enum BlogCategory {
  Web_Development
  Tutorial
  Design
  Programming
  News
}

enum BlogTags {
  REACT
  JAVASCRIPT
  TYPESCRIPT
  CSS
  HTML
  NODE_JS
  DESIGN
  UI_UX
}

enum UserRole {
  CUSTOMER
  ADMIN
}

enum AppointmentStatus {
  Upcoming
  Completed
  Cancelled
}

enum MeetingType {
  Virtual
  InPerson
  Phone
}

enum DocumentType {
  Invoice
  Appointment
  Profile
  Security
  Compliance
}

enum DocumentStatus {
  Open
  InReview
  Approved
}

enum InvoiceStatus {
  Paid
  Pending
  Overdue
}

enum SlotStatus {
  Available
  Booked
  Disabled
}

enum InvoicePaymentType {
  Cash
  BankTransfer
}

enum BlogStatus {
  Schedule
  Publish
}
